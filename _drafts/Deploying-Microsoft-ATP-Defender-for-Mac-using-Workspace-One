---
layout: post
title: Deploying Microsoft Defender ATP for macOS using Workspace ONE UEM
subtitle: Converting Jamf templates to Workspace ONE templates
tags: [macOS]
comments: true
---

I had a few folks recently approach me on the MacAdmins slack asking for help with deploying Microsoft Defender ATP for Mac.   We got it working, but it really came down to 2 issues:  conflicting documentation, Jamf and inTune specific templates.  Once I was able to parse through the Jamf/InTune documentation, we were able to put together some guidance which was recently published to the [EUC Samples GitHub Repository](https://github.com/vmware-samples/euc-samples/tree/master/macOS-Samples/3rd-Party_Software_Guidance/Microsoft-Defender-ATP).   

## Conflicting Documentation

The initial problem I found was some confusion generated by the documentation.  The first article, [Set Preferences for Microsoft Defender ATP](https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-atp/mac-preferences) referenced a payloadType of `com.microsoft.wdav`.   These preferences seem related to the UI and various configuration settings.  Basically, it sets what you do/do not want the user to have control of if they open Defender.  

The second article, [JAMF-based deployment for Microsoft Defender ATP for Mac](https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-atp/mac-install-with-jamf#configuration-profile), referenced a payloadType of `com.microsoft.wdav.atp`.  This "MDM Deployment" specific article only mentions the profile downloaded as part of the **Onboarding package**.  This specific profile looks geared towards licensing and linking the Defender ATP to your specific tenant in the threat protection cloud for telemetry.    

For anyone uninitiated, the **payloadType** in a configuration profile is essentially the key that tells macOS to which preference domain the key-value pairs apply.  As such, you'll usually find the payloadType relates to a payloadType.plist file somewhere in `/Library/Managed Preferences` (or `~/Library/Managed Preferences - don't forget to grant Terminal.app permissions in the Security & Privacy preferences in order to read the list of files at that location).   Initially, I found it odd that the Defender client would actually be reading TWO separate preference domains.  Also, neither article made mention of the other as a complete "story" for managing the client.

## Jamf and inTune Specifics

The [Deployment with a different MDM system](https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-atp/mac-install-with-other-mdm) article left a lot to be desired.  I find that in this instance, the Jamf-specific deployment information provided the specific detail required for us to put together an appropriate plan.   Much of the guidance in that article also applies to Workspace ONE UEM, but with some slightly different terminology:

### Jamf Policies = Profiles in Workspace ONE parlance

In Workspace ONE UEM, you need only click **Add > Profile** in the top right corner, and build a macOS Device profile.   While we typically suggest only a single payload per profile, in this instance you need multiple payloads for a single app.  In this case I would recommend constraining all these different payloads in the same Profile as it makes them easy to find and maintain as a whole.  Plus, none of the settings you'll be managing *should* conflict with other similar payloads creating an *undefined* condition. 

